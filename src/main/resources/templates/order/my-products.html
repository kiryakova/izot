<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<head>
    <th:block th:include="~{fragments/head}"></th:block>
</head>
<body>
<div class="container-fluid">
    <th:block th:include="~{fragments/navbar}"></th:block>
    <main class="mt-3">
        <h1 class="text-center text-izot">Продукти в кошницата</h1>
        <hr style="height: 2px" class="bg-izot w-75" />

        <th:block th:if="${order} == null">
            <h3 class="text-center text-izot">Нямате заявени продукти</h3>
            <hr style="height: 2px" class="bg-izot w-75" />
        </th:block>
        <th:block th:if="${order} != null">
        <!--<hr class="hr-2 bg-dark w-75">-->
        <table class="table table-hover w-75 mx-auto">
            <thead>
            <tr class="row mx-auto">
                <th class="col-md-1 text-center text-izot-bold">#</th>
                <th class="col-md-2 text-center text-izot-bold">Изображение</th>
                <th class="col-md-3 text-center text-izot-bold">Име</th>
                <th class="col-md-1 text-center text-izot-bold">Количество</th>
                <th class="col-md-2 text-center text-izot-bold">Ед.Цена</th>
                <th class="col-md-3 text-center text-izot-bold"></th>
            </tr>
            </thead>
            <tbody>
            <th:block th:each="orderedProduct, iter : ${orderedProducts}" th:object="${orderedProduct}">
                <tr class="row mx-auto" th:id="${orderedProduct.id}">
                    <td class="col-md-1 text-center text-izot" th:text="${iter.index + 1}"></td>
                    <td class="col-md-2 text-center text-izot">
                        <div class="text-center">
                        <img th:src="${orderedProduct.product.imageUrl}" width="40" height="40" alt="Product" />
                        </div>
                    </td>
                    <td class="col-md-3 text-center text-izot" th:text="${orderedProduct.product.name}"></td>
                    <td class="col-md-1 text-center text-izot" th:text="${orderedProduct.quantity}"></td>
                    <td class="col-md-2 text-center text-izot" th:text="${orderedProduct.product.price}"></td>
                    <td class="col-md-3 text-center">
                        <!--<a th:href="@{/products/delete/{id}(id=${orderedProduct.id})}" class="btn btn-danger font-weight-bold text-white">Изтриване</a>-->

                        <form id="order-product-form"  method="GET">
                            <div class="button-holder d-flex justify-content-center">
                                <!--<input id="orderedProduct-id" type="hidden" name="id" th:value="${orderedProduct.getId()}" />-->
                                <!--<input id="product-id" type="hidden" name="id" th:value="${orderedProduct.getProduct().getId()}" />-->
                                <!--<button id="btn-submit-order" type="button" class="btn btn-danger font-weight-bold text-white" th:onclick="'deleteProductFromOrder(\''+ ${orderedProduct.getId()} +'\')'">Премахни</button>-->
                                <!--<button th:id="${orderedProduct.getId()}" type="submit" class="btn btn-danger font-weight-bold text-white" th:onclick="deleteProduct()">Премахни</button>-->
                                <button th:value="${orderedProduct.id}" type="submit" class="btn btn-danger font-weight-bold text-white">Премахни</button>
                            </div>
                        </form>


                    </td>

                    <!--
                    <td class="col-md-3 text-center">
                        <button class="btn bg-izot text-white" data-toggle="modal" th:data-target="|#details-producer-modal-*{id}|">Детайли</button>
                        <th:block th:replace="fragments/modals/producer/details-producer-modal"></th:block>
                        <th:block th:replace="fragments/modals/producer/edit-producer-modal"></th:block>
                        <th:block th:replace="fragments/modals/producer/delete-producer-modal"></th:block>
                    </td>
                    -->
                </tr>

            </th:block>
            <tr class="row mx-auto">
                <!--<td class="col-md-1 text-center text-izot"></td>
                <td class="col-md-2 text-center text-izot"></td>
                <td class="col-md-3 text-center text-izot"></td>
                <td class="col-md-1 text-center text-izot"></td>-->
                <td colspan="3" class="col-md-4"></td>
                <td colspan="1" class="col-md-3 align-content-end">Обща стойност на поръчката:</td>
                <td class="col-md-2 text-center text-izot" th:id="totalPrice" th:text="${order.totalPrice}"></td>
                <td class="col-md-3"><a th:href="@{/customers/edit/{id}(id=${order.id})}" class="btn btn-danger font-weight-bold text-white">Продължи</a></td>
            </tr>

            <!--<tr class="row mx-auto">
                <td colspan="5" class="col-md-7"></td>
                <td class="col-md-3 text-center">
                    <a th:href="@{/orders/confirm/{id}(id=${order.id})}" class="btn btn-danger font-weight-bold text-white">Приключи Поръчката</a>
                </td>
            </tr>-->
            </tbody>
        </table>
        <hr style="height: 2px" class="bg-izot w-75">
        </th:block>
    </main>
    <th:block th:include="~{fragments/footer}"></th:block>
</div>
</body>
<script type="text/javascript">

    function deleteProductFromOrder(orderedProductId) {
        //let orderedProductId = $("#orderedProduct-id").val();
        let divIdForDelete = "#" + orderedProductId;
        //let orderId = $("#order-id").val();

        fetch('/fetch/order/product/delete/' + orderedProductId)
            .then((response) => response.json())
            .then((json) => {
                //if (json === true) {
                    //alert("Продуктът е премахнат");
                    //window.location = '/orders/products/my';
                $(divIdForDelete).hide();
                $("#totalPrice").empty();
                $("#totalPrice").append(json.toFixed(2));
                //$("#totalPrice").append('лв&#46;');


                //}
            })
            .catch((err) => console.log(err));


        /*       http.get("/fetch/order/submit", {id})
               .then(() => window.location = '/products/all/products');
           ev.preventDefault();
   */
        //return false;

    }

    jQuery('button').on('click', function(){
        //alert($(this).text());
        deleteProductFromOrder($(this).val());
        return false;
    });
    /*$("#order-product-form").on('submit', (ev) => {
        deleteProductFromOrder($(this).id);
    });*/
</script>
</html>